<!--
SPDX-FileCopyrightText: 2019-2020 Intel Corporation

SPDX-License-Identifier: MIT
-->



<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>oneMKL RNG Usage Model &mdash; oneAPI Specification 1.0-rev-2 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../../_static/favicons.png"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/language_data.js"></script>
        <script src="../../../../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="Generate Routine" href="generate-routine.html" />
    <link rel="prev" title="Random Number Generators (RNG) Overview" href="overview.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://oneapi.com" class="icon icon-home"> oneAPI Specification
          

          
            
            <img src="../../../../../_static/oneAPI-rgb-rev-100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0-rev-2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dpcpp/source/index.html">DPC++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneDPL/source/index.html">oneDPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneDNN/source/index.html">oneDNN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneCCL/source/index.html">oneCCL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../l0/source/index.html">Level Zero</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneDAL/source/index.html">oneDAL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneTBB/source/nested-index.html">oneTBB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneVPL/source/index.html">oneVPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oneVPL/source/index.html#onevpl-specification-version">oneVPL Specification Version</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">oneMKL</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../architecture/architecture.html">oneMKL Architecture</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../domains.html">oneMKL Domains</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../domains.html#dense-linear-algebra">Dense Linear Algebra</a></li>
<li class="toctree-l3"><a class="reference internal" href="../domains.html#sparse-linear-algebra">Sparse Linear Algebra</a></li>
<li class="toctree-l3"><a class="reference internal" href="../domains.html#discrete-fourier-transforms">Discrete Fourier Transforms</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../domains.html#random-number-generators">Random Number Generators</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="overview.html">Random Number Generators (RNG) Overview</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">oneMKL RNG Usage Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="generate-routine.html">Generate Routine</a></li>
<li class="toctree-l4"><a class="reference internal" href="engines-basic-random-number-generators.html">Engines (Basic Random Number Generators)</a></li>
<li class="toctree-l4"><a class="reference internal" href="service-routines.html">Service Routines</a></li>
<li class="toctree-l4"><a class="reference internal" href="distributions.html">Distributions</a></li>
<li class="toctree-l4"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../domains.html#summary-statistics">Summary Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../domains.html#vector-math">Vector Math</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../appendix/appendix.html">oneMKL Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../versions.html">HTML and PDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../notices.html">Legal Notices and Disclaimers</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">oneAPI Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <!--
SPDX-FileCopyrightText: 2019-2020 Intel Corporation

SPDX-License-Identifier: MIT
-->

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">oneAPI Specification</a> &raquo;</li>
        
          
          <li><a href="../../index.html">oneMKL</a> </li>
          
        
          
        
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/oneapi-src/oneapi-spec/blob/master/source/elements/oneMKL/source/domains/rng/onemkl-rng-usage-model.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="onemkl-rng-usage-model">
<span id="id3"></span><h1>oneMKL RNG Usage Model<a class="headerlink" href="#onemkl-rng-usage-model" title="Permalink to this headline">¶</a></h1>
<p class="rubric">Description</p>
<p>A typical algorithm for random number generators is as follows:</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Create and initialize the object for basic random number</dt><dd><p>generator.</p>
</dd>
</dl>
</li>
</ol>
<ul class="simple">
<li><dl class="simple">
<dt>Use the skip_ahead or leapfrog function if it is required (used</dt><dd><p>in parallel with random number generation for Host and CPU
devices).</p>
</dd>
</dl>
</li>
</ul>
<ol class="arabic simple" start="2">
<li><p>Create and initialize the object for distribution generator.</p></li>
<li><dl class="simple">
<dt>Call the generate routine to get random numbers with appropriate</dt><dd><p>statistical distribution.</p>
</dd>
</dl>
</li>
</ol>
<p>The following example demonstrates generation of random numbers that
is output of basic generator (engine) PHILOX4X32X10. The seed is
equal to 777. The generator is used to generate 10,000 normally
distributed random numbers with parameters <code class="docutils literal notranslate"><span class="pre">a</span></code> = 5 and <code class="docutils literal notranslate"><span class="pre">sigma</span></code>=
2. The purpose of the example is to calculate the sample mean for
normal distribution with the given parameters.</p>
<div class="section" id="buffer-based-example">
<h2>Buffer-based example<a class="headerlink" href="#buffer-based-example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;CL/sycl.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;mkl_rng_sycl.hpp&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">sycl</span><span class="o">::</span><span class="n">queue</span> <span class="n">queue</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="kt">uint64_t</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">777</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

    <span class="n">oneapi</span><span class="o">::</span><span class="n">mkl</span><span class="o">::</span><span class="n">rng</span><span class="o">::</span><span class="n">philox4x32x10</span> <span class="n">engine</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">seed</span><span class="p">);</span> <span class="c1">// basic random number generator object</span>
    <span class="n">oneapi</span><span class="o">::</span><span class="n">mkl</span><span class="o">::</span><span class="n">rng</span><span class="o">::</span><span class="n">gaussian</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="n">oneapi</span><span class="o">::</span><span class="n">mkl</span><span class="o">::</span><span class="n">rng</span><span class="o">::</span><span class="n">gaussian_method</span><span class="o">::</span><span class="n">box_muller2</span><span class="o">&gt;</span> <span class="n">distr</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">);</span> <span class="c1">//  distribution object</span>

    <span class="p">{</span>
        <span class="c1">//create buffer for random numbers</span>
        <span class="n">sycl</span><span class="o">::</span><span class="n">buffer</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="n">r_buf</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">r</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
        <span class="n">oneapi</span><span class="o">::</span><span class="n">mkl</span><span class="o">::</span><span class="n">rng</span><span class="o">::</span><span class="n">generate</span><span class="p">(</span><span class="n">distr</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">r_buf</span><span class="p">);</span> <span class="c1">// perform generation</span>
    <span class="p">}</span>

    <span class="kt">double</span> <span class="n">s</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">s</span> <span class="o">/=</span> <span class="n">n</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Average = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="usm-based-example">
<h2>USM-based example<a class="headerlink" href="#usm-based-example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;CL/sycl.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;mkl_rng_sycl.hpp&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">sycl</span><span class="o">::</span><span class="n">queue</span> <span class="n">queue</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="kt">uint64_t</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">777</span><span class="p">;</span>

    <span class="c1">// create USM allocator</span>
    <span class="n">sycl</span><span class="o">::</span><span class="n">usm_allocator</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="n">sycl</span><span class="o">::</span><span class="n">usm</span><span class="o">::</span><span class="n">alloc</span><span class="o">::</span><span class="n">shared</span><span class="o">&gt;</span> <span class="n">allocator</span><span class="p">(</span><span class="n">queue</span><span class="p">.</span><span class="n">get_context</span><span class="p">(),</span> <span class="n">queue</span><span class="p">.</span><span class="n">get_device</span><span class="p">());</span>

    <span class="c1">// create vector with USM allocator</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="n">sycl</span><span class="o">::</span><span class="n">usm_allocator</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="n">sycl</span><span class="o">::</span><span class="n">usm</span><span class="o">::</span><span class="n">alloc</span><span class="o">::</span><span class="n">shared</span><span class="o">&gt;&gt;</span> <span class="n">r</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">allocator</span><span class="p">);</span>

    <span class="n">oneapi</span><span class="o">::</span><span class="n">mkl</span><span class="o">::</span><span class="n">rng</span><span class="o">::</span><span class="n">philox4x32x10</span> <span class="n">engine</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">seed</span><span class="p">);</span> <span class="c1">// basic random number generator object</span>
    <span class="n">oneapi</span><span class="o">::</span><span class="n">mkl</span><span class="o">::</span><span class="n">rng</span><span class="o">::</span><span class="n">gaussian</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="n">oneapi</span><span class="o">::</span><span class="n">mkl</span><span class="o">::</span><span class="n">rng</span><span class="o">::</span><span class="n">gaussian_method</span><span class="o">::</span><span class="n">box_muller2</span><span class="o">&gt;</span> <span class="n">distr</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">);</span> <span class="c1">// distribution object</span>

    <span class="k">auto</span> <span class="n">event</span> <span class="o">=</span> <span class="n">oneapi</span><span class="o">::</span><span class="n">mkl</span><span class="o">::</span><span class="n">rng</span><span class="o">::</span><span class="n">generate</span><span class="p">(</span><span class="n">distr</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">data</span><span class="p">());</span> <span class="c1">// perform generation</span>
    <span class="c1">// sycl::event object is returned by generate function for synchronization</span>
    <span class="n">event</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span> <span class="c1">// synchronization can be also done by queue.wait()</span>

    <span class="kt">double</span> <span class="n">s</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">s</span> <span class="o">/=</span> <span class="n">n</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Average = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="rubric">USM usage</p>
<p>You can also use USM with raw pointers by using the sycl::malloc_shared/malloc_device functions.</p>
<p><strong>Parent topic:</strong> <a class="reference internal" href="../domains.html#onemkl-rng"><span class="std std-ref">Random Number Generators</span></a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="generate-routine.html" class="btn btn-neutral float-right" title="Generate Routine" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="overview.html" class="btn btn-neutral float-left" title="Random Number Generators (RNG) Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Intel Corporation

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>