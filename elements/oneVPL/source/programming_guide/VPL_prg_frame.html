

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Frame and Fields &mdash; oneAPI Specification 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../_static/favicons.png"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Decoding Procedures" href="VPL_prg_decoding.html" />
    <link rel="prev" title="oneVPL Session" href="VPL_prg_session.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://oneapi.com" class="icon icon-home"> oneAPI Specification
          

          
            
            <img src="../../../../_static/oneAPI-rgb-rev-100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../library-interop.html">Library Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../elements.html">oneAPI Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dpcpp/source/index.html">DPC++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDPL/source/index.html">oneDPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDNN/source/index.html">oneDNN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneCCL/source/index.html">oneCCL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../l0/source/index.html">Level Zero</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDAL/source/index.html">oneDAL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneTBB/source/nested-index.html">oneTBB</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">oneVPL</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../architecture/index.html">Architecture</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Programming Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_stc.html">Status Codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_session.html">oneVPL Session</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Frame and Fields</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#frame-surface-management">Frame Surface Management</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_decoding.html">Decoding Procedures</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_encoding.html">Encoding Procedures</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_vpp.html">Video Processing Procedures</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_transcoding.html">Transcoding Procedures</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_hw.html">Hardware Acceleration</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_mem.html">Memory Allocation and External Allocators</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_err.html">Hardware Device Error Handling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../VPL_summary.html">Mandatory APIs and Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API_ref/VPL_api_ref.html">oneVPL API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Versioning.html">oneVPL API Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendix/index.html">Appendices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../VPL_acronyms.html">Glossary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneMKL/source/index.html">oneMKL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../versions.html">HTML and PDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notices.html">Legal Notices and Disclaimers</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">oneAPI Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">oneAPI Specification</a> &raquo;</li>
        
          
          <li><a href="../index.html">oneVPL</a> </li>
          
        
          
        
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/oneapi-src/oneapi-spec/blob/master/source/elements/oneVPL/source/programming_guide/VPL_prg_frame.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="frame-and-fields">
<h1>Frame and Fields<a class="headerlink" href="#frame-and-fields" title="Permalink to this headline">¶</a></h1>
<p>In oneVPL terminology, a frame (also referred to as frame surface) contains either
a progressive frame or a complementary field pair. If the frame is a
complementary field pair, the odd lines of the surface buffer store the top
fields and the even lines of the surface buffer store the bottom fields.</p>
<div class="section" id="frame-surface-management">
<span id="frame-surface-manag"></span><h2>Frame Surface Management<a class="headerlink" href="#frame-surface-management" title="Permalink to this headline">¶</a></h2>
<p>During encoding, decoding, or video processing, cases arise that require reserving
input or output frames for future use. For example, when decoding, a frame that
is ready for output must remain as a reference frame until the current sequence
pattern ends. The usual method to manage this is to cache the frames internally.
This method requires a copy operation, which can significantly reduce performance.</p>
<p>oneVPL has two approaches to avoid the need for copy operations. The legacy approach
uses a frame-locking mechanism that works as follows:</p>
<ol class="arabic simple">
<li><p>The application allocates a pool of frame surfaces large enough to include oneVPL
function I/O frame surfaces and internal cache needs. Each frame surface
maintains a <code class="docutils literal notranslate"><span class="pre">Locked</span></code> counter, which is part of the <a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv412mfxFrameData" title="mfxFrameData"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxFrameData</span></code></a>
structure. The <code class="docutils literal notranslate"><span class="pre">Locked</span></code> counter is initially set to zero.</p></li>
<li><p>The application calls a oneVPL function with frame surfaces from the pool whose
<code class="docutils literal notranslate"><span class="pre">Locked</span></code> counter is set as appropriate for the desired operation. For decoding
or video processing operations, where oneVPL uses the surfaces to write, the
<code class="docutils literal notranslate"><span class="pre">Locked</span></code> counter should be equal to zero. If the oneVPL function needs to reserve
any frame surface, the oneVPL function increases the <code class="docutils literal notranslate"><span class="pre">Locked</span></code> counter of the frame
surface. A non-zero <code class="docutils literal notranslate"><span class="pre">Locked</span></code> counter indicates that the calling application must
treat the frame surface as “in use.” When the frame surface is in use, the
application can read but cannot alter, move, delete, or free the frame surface.</p></li>
<li><p>In subsequent oneVPL executions, if the frame surface is no longer in use,
oneVPL decreases the <code class="docutils literal notranslate"><span class="pre">Locked</span></code> counter. When the <code class="docutils literal notranslate"><span class="pre">Locked</span></code> counter reaches zero, the
application is free to do as it wishes with the frame surface.</p></li>
</ol>
<p>In general, the application should not increase or decrease the <code class="docutils literal notranslate"><span class="pre">Locked</span></code> counter
since oneVPL manages this field. If, for some reason, the application needs to
modify the <code class="docutils literal notranslate"><span class="pre">Locked</span></code> counter, the operation must be atomic to avoid a race condition.</p>
<p>oneVPL API version 2.0 introduces the <a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv424mfxFrameSurfaceInterface" title="mfxFrameSurfaceInterface"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxFrameSurfaceInterface</span></code></a> structure
which provides a set of callback functions for the <a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv416mfxFrameSurface1" title="mfxFrameSurface1"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxFrameSurface1</span></code></a>
structure to work with frame surfaces. This interface defines <a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv416mfxFrameSurface1" title="mfxFrameSurface1"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxFrameSurface1</span></code></a> as a
reference counted object which can be allocated by oneVPL or the application. The
application must follow the general rules of operation with reference counted
objects. For example, when surfaces are allocated by oneVPL during
<a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv431MFXVideoDECODE_DecodeFrameAsync10mfxSessionP12mfxBitstreamP16mfxFrameSurface1PP16mfxFrameSurface1P12mfxSyncPoint" title="MFXVideoDECODE_DecodeFrameAsync"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeFrameAsync()</span></code></a> or with the help of
<a class="reference internal" href="../API_ref/VPL_func_mem.html#_CPPv426MFXMemory_GetSurfaceForVPP10mfxSessionPP16mfxFrameSurface1" title="MFXMemory_GetSurfaceForVPP"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXMemory_GetSurfaceForVPP()</span></code></a> or <a class="reference internal" href="../API_ref/VPL_func_mem.html#_CPPv429MFXMemory_GetSurfaceForEncode10mfxSessionPP16mfxFrameSurface1" title="MFXMemory_GetSurfaceForEncode"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXMemory_GetSurfaceForEncode()</span></code></a>,
the application must call the corresponding
<a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv4N24mfxFrameSurfaceInterface7ReleaseE" title="mfxFrameSurfaceInterface::Release"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">mfxFrameSurfaceInterface::Release</span></code></a>
function for the surfaces that are no longer in use.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">Locked</span></code> counter defines read/write access policies
and the reference counter is responsible for managing a frame’s
lifetime.</p>
</div>
<p>The second approach to avoid the need for copy operations is based on the
<a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv424mfxFrameSurfaceInterface" title="mfxFrameSurfaceInterface"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxFrameSurfaceInterface</span></code></a> and works as follows:</p>
<ol class="arabic simple">
<li><p>oneVPL or the application allocates a frame surface and the application stores
a value of reference counter obtained through
<a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv4N24mfxFrameSurfaceInterface13GetRefCounterE" title="mfxFrameSurfaceInterface::GetRefCounter"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">mfxFrameSurfaceInterface::GetRefCounter</span></code></a>.</p></li>
<li><p>The application calls a oneVPL function with the frame surface. If oneVPL needs
to reserve the frame surface it increments the reference counter through the
<a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv4N24mfxFrameSurfaceInterface6AddRefE" title="mfxFrameSurfaceInterface::AddRef"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">mfxFrameSurfaceInterface::AddRef</span></code></a> call.
When the frame surface is no longer in use by the oneVPL it decrements reference counter through
the <a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv4N24mfxFrameSurfaceInterface7ReleaseE" title="mfxFrameSurfaceInterface::Release"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">mfxFrameSurfaceInterface::Release</span></code></a> call
which returns the reference counter to the original value.</p></li>
<li><p>The application checks the reference counter of the frame surface and when it is equal
to the original value after allocation, it can reuse the reference counter for subsequent operations.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All <a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv416mfxFrameSurface1" title="mfxFrameSurface1"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxFrameSurface1</span></code></a> structures starting from
mfxFrameSurface1::mfxStructVersion = {1,1} support the
<a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv424mfxFrameSurfaceInterface" title="mfxFrameSurfaceInterface"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxFrameSurfaceInterface</span></code></a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="VPL_prg_decoding.html" class="btn btn-neutral float-right" title="Decoding Procedures" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="VPL_prg_session.html" class="btn btn-neutral float-left" title="oneVPL Session" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Intel Corporation

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>